# Script pour ajouter le widget de vuln√©rabilit√©s dans l'Admin Dashboard
$ErrorActionPreference = "Stop"

Write-Host "üîß Ajout du Widget de Vuln√©rabilit√©s..." -ForegroundColor Cyan

$file = "c:\STS\mediatech_app\frontend\src\app\pages\admin-dashboard\admin-dashboard.component.ts"

# Lire le fichier
$content = Get-Content $file -Raw -Encoding Unicode

# V√©rifier si d√©j√† install√©
if ($content -match "app-vulnerability-widget") {
    Write-Host "‚ö†Ô∏è  Le widget est d√©j√† install√©!" -ForegroundColor Yellow
    exit 0
}

# Pr√©parer le code HTML du widget
$widgetHtml = "`n        `n        <!-- VULNERABILITY SCANNER SECTION -->`n        <div class=`"vulnerability-section`">`n          <app-vulnerability-widget></app-vulnerability-widget>`n        </div>`n        `n"

# Trouver et remplacer juste avant Command Center Navigation
$searchText = "        <!-- Command Center Navigation -->"
if ($content.Contains($searchText)) {
    $content = $content.Replace($searchText, $widgetHtml + $searchText)
    Write-Host "‚úÖ Widget HTML ajout√©" -ForegroundColor Green
} else {
    Write-Host "‚ùå Impossible de trouver le point d'insertion" -ForegroundColor Red
    exit 1
}

# Ajouter le style CSS pour la section
$cssStyle = "`n    .vulnerability-section {`n      margin: 2rem 0;`n      padding: 0 1rem;`n    }`n"

# Chercher la fin des styles
$styleEndPattern = "  ]"
$exportPattern = "export class AdminDashboardComponent"
$styleEndIndex = $content.LastIndexOf($styleEndPattern + "`r`n)")
if ($styleEndIndex -gt 0) {
    $beforeExport = $content.Substring(0, $styleEndIndex)
    $afterExport = $content.Substring($styleEndIndex)
    $content = $beforeExport + $cssStyle + $afterExport
    Write-Host "‚úÖ Styles CSS ajout√©s" -ForegroundColor Green
}

# Sauvegarder
$content | Set-Content $file -Encoding Unicode
Write-Host "`n‚úÖ Installation termin√©e avec succ√®s!" -ForegroundColor Green
Write-Host "`nüìã Prochaines √©tapes:" -ForegroundColor Cyan
Write-Host "  1. Assurez-vous que MySQL tourne (port 3306)" -ForegroundColor White
Write-Host "  2. D√©marrez le backend si ce n'est pas fait" -ForegroundColor White
Write-Host "  3. Rechargez votre navigateur (F5)" -ForegroundColor White
Write-Host "  4. Connectez-vous en tant qu'admin" -ForegroundColor White
Write-Host "`nüéâ Vous verrez maintenant les vuln√©rabilit√©s dans votre dashboard!" -ForegroundColor Green
